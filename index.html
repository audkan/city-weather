<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SF Microclimates</title>
    <meta name="description" content="Displays San Francisco"s microclimates">
    <link rel="icon" href="img/city.png">
    <link rel="apple-touch-icon" href="img/city.png">
    <meta property="og:title" content="SF Microclimates">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://audkan.github.io/city-weather/">
    <meta property="og:description" content="Displays San Francisco"s microclimates">
    <meta property="og:image" content="img/city.png">
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css" />
    <link rel="stylesheet" href="stylesheets/style.css" />
  </head>
  <body>
    <div class="full">
      <div id="map"></div>
    </div>

    <div id="console">
      <h1>San Francisco Microclimates</h1>
      <p>Data provided by
        <a target="_blank" href="https://openweathermap.org/api">OpenWeather API</a>
      </p>
      <div class="session">
        <h2>Temperature</h2>
        <div class="row colors">
        </div>
        <div class="row labels">
          <div class="label">32</div>
          <div class="label">55</div>
          <div class="label">60</div>
          <div class="label">65</div>
          <div class="label">70</div>
          <div class="label">75+</div>
        </div>
      </div>
      <div class="session" id="sliderbar">
        <h2>Hour: <label id="active-hour"></label></h2>
        <input id="slider" class="row" type="range" min="0" max="23" step="0" value="1" />
      </div>
    </div>

    <footer>
      Made by <a target="_blank" href="https://www.instagram.com/oddreeezy/">audkan</a> & <a target="_blank" href="https://github.com/AndrewTheo">andrewtheo</a> | Code on <a target="_blank" href="http://github.com/audkan/word-clock">GitHub&nbsp;</a>
    </footer>
  </body>

  <script>
    mapboxgl.accessToken = "pk.eyJ1Ijoib2RkcmVlZXp5IiwiYSI6ImNrYWticDVyeTBlejcycmxiZ2pzZzl1MnQifQ.Cl-_75c_mRIs4IE1HHXSsg";

    var map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/oddreeezy/ckakjxh7l10ld1inzgt0gnh2x",
      center: [-122.486, 37.762],
      zoom: 11.5,
      interactive: false,
      attributionControl: false
    });

    map.on("load", function() {
      map.addLayer({
        id: "collisions",
        type: "circle",
        source: {
          type: "geojson",
          data: "./collisions1601.geojson" // Replace this
        },
        paint: {
          "circle-radius": [
            "interpolate",
            ["linear"],
            ["number", ["get", "Casualty"]],
            0, 4,
            5, 24
          ],
          "circle-color": [
            "interpolate",
            ["linear"],
            ["number", ["get", "Casualty"]],
            0, "#4892C7",
            1, "#0568d6",
            2, "#a1c85c",
            3, "#FFBD3A",
            4, "#FF860A",
            5, "#E00300"
          ],
          "circle-opacity": 0.8
        },
        filter: ["==", ["number", ["get", "Hour"]], 12]
      });
    });

    function resizeMap(m) {
      if (m.matches) {
        var mapDiv = document.getElementById("map");
        map.setZoom(10.6);
        map.setCenter([-122.436, 37.820]);
      } else {
        map.setZoom(11.5);
        map.setCenter([-122.486, 37.762]);
      }
    }

    var isSmaller = window.matchMedia("(max-width: 530px)")
    resizeMap(isSmaller)
    isSmaller.addListener(resizeMap)

    var now = new Date();
    var ticks = [];
    for (var i = 0; i <= 24; i++) {
      now.setHours( now.getHours() + 1);
      var hha = now.toLocaleString("en-US", { hour: "numeric", hour12: true });
      hha = hha.replace(" ", ":00 ");
      ticks.push(hha);
    }

    document.getElementById("slider").addEventListener("input", function(e) {
      var hour = parseInt(e.target.value);
      //map.setFilter("collisions", ["==", ["number", ["get", "Hour"]], hour]);
      //var ampm = hour >= 12 ? "PM" : "AM";
      //var hour12 = hour % 12 ? hour % 12 : 12;
      //document.getElementById("active-hour").innerText = hour12 + ampm;
      document.getElementById("active-hour").innerHTML=ticks[hour];
    });
  </script>
</html>
